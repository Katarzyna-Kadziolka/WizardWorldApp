@using WizardWorldApp.Data
@inject HttpClient httpClient

<MudTable Items="@_houses" Dense="@_dense" Hover="@_hover" Bordered="@_bordered" Striped="@_striped" 
          Filter="new Func<House, bool>(FilterFunc1)" @bind-SelectedItem="_selectedItem1">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Houses</MudText>
        <MudSpacer/>
        <MudTextField @bind-Value="_searchString1" Placeholder="Search" Adornment="Adornment.Start" 
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Common Room</MudTh>
        <MudTh>House Colours</MudTh>
        <MudTh>Animal</MudTh>
        <MudTh>Element</MudTh>
        <MudTh>Founder</MudTh>
        <MudTh>Ghost</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">@context.Name</MudTd>
        <MudTd DataLabel="Common Room">@context.CommonRoom</MudTd>
        <MudTd DataLabel="House Colours">@context.HouseColours</MudTd>
        <MudTd DataLabel="Animal">@context.Animal</MudTd>
        <MudTd DataLabel="Element">@context.Element</MudTd>
        <MudTd DataLabel="Founder">@context.Founder</MudTd>
        <MudTd DataLabel="Ghost">@context.Ghost</MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager/>
    </PagerContent>
</MudTable>

@code {
    private bool _dense = false;
    private bool _hover = true;
    private bool _striped = true;
    private bool _bordered = false;
    private string _searchString1 = "";
    private string _searchString2 = "";
    private House _selectedItem1 = null;
    private House _selectedItem2 = null;
    private string _traits = "";

    private HashSet<House> _selectedItems = new HashSet<House>();

    private IEnumerable<House> _houses = new List<House>();

    protected override async Task OnInitializedAsync() {
    //Elements = await httpClient.GetFromJsonAsync<List<Element>>("webapi/periodictable");
        _houses = new List<House>() {
            new House {
                Id = Guid.NewGuid(),
                Name = "Griffindor",
                CommonRoom = "The tower",
                HouseColours = "Red, gold",
                Animal = "Lion",
                Element = "Sword",
                Founder = "Godryk Gryffindor",
                Ghost = "Prawie Bezgłowy Nick",
                Heads = new List<HouseHead>(),
                Traits = new List<Trait> {
                    new Trait {
                        Id = Guid.NewGuid(),
                        Name = TraitName.None
                    }
                }
            },
            new House {
                Id = Guid.NewGuid(),
                Name = "Ravenclaw",
                CommonRoom = "The highest tower",
                HouseColours = "Blue, silver",
                Animal = "Raven",
                Element = "Goblet",
                Founder = "Rowena Ravenclaw",
                Ghost = "Szara Dama",
                Heads = new List<HouseHead>(),
                Traits = new List<Trait> {
                    new Trait {
                        Id = Guid.NewGuid(),
                        Name = TraitName.None
                    }
                }
            },
            new House {
                Id = Guid.NewGuid(),
                Name = "Slytherin",
                CommonRoom = "The castle dungeons",
                HouseColours = "Green, silver",
                Animal = "Snake",
                Element = "Dagger",
                Founder = "Salazar Slytherin",
                Ghost = "Krwawy Baron",
                Heads = new List<HouseHead>(),
                Traits = new List<Trait> {
                    new Trait {
                        Id = Guid.NewGuid(),
                        Name = TraitName.None
                    }
                },
            },
        };
    }

    private bool FilterFunc1(House spell) => FilterFunc(spell, _searchString1);
    private bool FilterFunc2(House spell) => FilterFunc(spell, _searchString2);

    private bool FilterFunc(House house, string searchString) {
        var traitsNames = house.Traits.Select(a => a.Name).ToList();
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (house.Name.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.CommonRoom.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.HouseColours.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.Ghost.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.Animal.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.Founder.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (house.Element.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        return false;
    }

}